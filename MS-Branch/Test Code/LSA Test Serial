//LSA
int enableLSA1 = 22;
int enableLSA2 = 26;
int enableLSA3 = 24;
int valLSA1 = 0;
int valLSA2 = 0;
int valLSA3 = 0;
HardwareSerial *lsaSerial = NULL;

void setLsaSerial (HardwareSerial *serial); //so that serial has to be changed only once

void setup() {

  setLsaSerial(&Serial2);
  lsaSerial->begin(38400);
  Serial.begin(38400);
  pinMode(enableLSA1, OUTPUT);
  pinMode(enableLSA2, OUTPUT);
  pinMode(enableLSA3, OUTPUT);

  digitalWrite(enableLSA1, LOW);
  digitalWrite(enableLSA2, LOW);
  digitalWrite(enableLSA3, LOW);
}

void loop()
{
  readLSA();
}

void clearLSA()
{
  while (lsaSerial->available())
  {
    lsaSerial->read();
  }
}

void readLSA()
{
  Serial.print("Values : ");
 clearLSA();
  digitalWrite(enableLSA1, HIGH);
  delay(1000);
  while (!(lsaSerial->available()));
  while (lsaSerial->available())
  {
  valLSA1 = lsaSerial->read();
  
  }
  digitalWrite(enableLSA1, LOW);
clearLSA();
  delayMicroseconds(1000);

  digitalWrite(enableLSA2, HIGH);
  delayMicroseconds(1000);
  while (!(lsaSerial->available()));
  while (lsaSerial->available())
  { //@AM
    valLSA2 = lsaSerial->read();
    if (valLSA2 == 255) continue;
    else break;
  }
  digitalWrite(enableLSA2, LOW);
  clearLSA();
  delayMicroseconds(1000);

  digitalWrite(enableLSA3, HIGH);
  delay(1000);
  while (!(lsaSerial->available()));
  while (lsaSerial->available())
  {
    valLSA3 = lsaSerial->read();
  }
  digitalWrite(enableLSA3, LOW);
  clearLSA();
  delayMicroseconds(1000);



  Serial.print(valLSA1);
  Serial.print(',');
  Serial.print(valLSA2);
  Serial.print(',');
  Serial.println(valLSA3);

}
void setLsaSerial (HardwareSerial *serial)
{
  lsaSerial = serial;
}
